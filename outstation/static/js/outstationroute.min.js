!function(e){"use strict";var t,i={},l={},n=!1,o=!1,s=!0;let a=[].slice.call(document.querySelectorAll("picture.lazy")),c=[].slice.call(document.querySelectorAll("img.lazy")),r=!1;var d=function(){e("#selectedFilterView").empty(),e.each(i,function(t,i){e("#selectedFilterView").append("<div class='tag-selected'>"+i+"</div>")}),e.each(l,function(t,i){e("#selectedFilterView").append("<div class='tag-selected'>"+i+"</div>")}),e("#selectedFilterView").removeClass("hide")},u=function(){e.isEmptyObject(i)&&e.isEmptyObject(l)?(e("#dynamicRouteMap").children("div").each(function(){e(this).hasClass("hide")&&e(this).removeClass("hide")}),e("#placesOnRoute").children("div").each(function(){e(this).hasClass("hide")&&e(this).removeClass("hide")})):e.each(t.on_route_places.places,function(t,n){var o=n,s=o.location_tags,a=o.trip_types,c=!1,r="placeOnRoute-"+o.id,d="mapBlock-"+o.id;e.each(s,function(t,l){if(null!=i[l.id])return e("#"+r).removeClass("hide"),e("#"+d).removeClass("hide"),c=!0,!1}),c||e.each(a,function(t,i){if(null!=l[i.id])return e("#"+r).removeClass("hide"),e("#"+d).removeClass("hide"),c=!0,!1}),c||(e("#"+r).addClass("hide"),e("#"+d).addClass("hide")),c=!1})};e("#like_button_form").submit(function(t){t.preventDefault(),e.ajax({type:"POST",url:"/like/",data:{route_id:route.routeId(),csrfmiddlewaretoken:e("input[name=csrfmiddlewaretoken]").val()},success:function(t){e("#likes_count").html(t.likes_count),1==t.is_liked?e("#like_button").addClass("border-bottom"):e("#like_button").removeClass("border-bottom")}})});var h=function(){e("#reviewListPanel").addClass("hide"),e("#writeReviewPanel").removeClass("hide"),e("html, body").animate({scrollTop:e("#writeReviewPanel").offset().top})};const p=function(){!1===r&&(r=!0,setTimeout(function(){a.forEach(function(e){if(e.getBoundingClientRect().top<=window.innerHeight&&e.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(e).display){[].slice.call(e.querySelectorAll("source")).forEach(function(e){e.srcset=e.dataset.srcset}),e.classList.remove("lazy"),a=a.filter(function(t){return t!==e})}}),c.forEach(function(e){e.getBoundingClientRect().top<=window.innerHeight&&e.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(e).display&&(e.src=e.dataset.src,e.classList.remove("lazy"),c=c.filter(function(t){return t!==e}))}),0===c.length&&0===a.length&&document.removeEventListener("scroll",p),r=!1},200))};e(document).scroll(p),e(function(){fetch("/api/v2/pages/"+route.routeId()+"/").then(e=>e.json()).then(e=>{t=e}),e("#routeMapButton").click(function(t){s?(s=!1,e("#filterPanel").removeClass("hide")):(e("#selectAllButton").addClass("hide"),e("#editButton").removeClass("hide"),e("#routeMapButton").addClass("hide"),e("#filterView").addClass("hide"),d(),u())}),e("#placeFilter").on("click",function(t){if(t.stopImmediatePropagation(),t.target!==t.currentTarget){var l=t.target,n=e(l).val(),o=e(l).text();e(l).hasClass("tag-button-down")?(l.classList.add("tag-button-up"),l.classList.remove("tag-button-down"),delete i[n]):(l.classList.add("tag-button-down"),l.classList.remove("tag-button-up"),null==i[n]&&(i[n]=o))}}),e("#tripTypeFilter").on("click",function(t){if(t.stopImmediatePropagation(),t.target!==t.currentTarget){var i=t.target,n=e(i).val(),o=e(i).text();e(i).hasClass("tripType-button-down")?(i.classList.add("tripType-button-up"),i.classList.remove("tripType-button-down"),delete l[n]):(i.classList.add("tripType-button-down"),i.classList.remove("tripType-button-up"),null==l[n]&&(l[n]=o))}}),e("#editButton").on("click",function(t){e("#selectAllButton").removeClass("hide"),e("#editButton").addClass("hide"),e("#routeMapButton").removeClass("hide"),e("#filterView").removeClass("hide"),e("#selectedFilterView").addClass("hide")}),e("#selectAllButton").on("click",function(t){t.stopImmediatePropagation(),n?(i={},e("#placeFilter").children("button").each(function(){e(this).removeClass("tag-button-down"),e(this).addClass("tag-button-up"),e("#selectAllButton").html("Select All"),e(this).val()})):e("#placeFilter").children("button").each(function(){e(this).addClass("tag-button-down"),e(this).removeClass("tag-button-up"),e("#selectAllButton").html("Remove All");var t=e(this).val(),l=e(this).text();null==i[t]&&(i[t]=l)}),n=!n}),e("#writeReviewButton").on("click",function(t){o?h():e.getScript(route.reviewsStaticURL(),function(){o=!0,h()})})})}(jQuery);